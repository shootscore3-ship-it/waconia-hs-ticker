<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Waconia HS Fullscreen Ticker</title>
  <style>
    :root{
      --bg0:#070a10;
      --bg1:#0b0f14;
      --bg2:#111826;

      --text:#f3f6ff;
      --muted:rgba(243,246,255,.70);
      --line:rgba(255,255,255,.10);
      --sep:rgba(243,246,255,.18);

      --teal:#2dd4bf;
      --lime:#a3e635;
      --amber:#fbbf24;
      --red:#fb7185;

      --shadow: 0 10px 26px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:transparent;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;overflow:hidden}
    body{background:linear-gradient(180deg,var(--bg0),#05070c);}

    /* FULLSCREEN FRAME */
    .app{
      height:100%;
      display:flex;
      flex-direction:column;
    }

    /* TOP STRIP */
    .topbar{
      height:94px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:16px 22px;
      background:linear-gradient(90deg,var(--bg1),var(--bg2));
      border-bottom:1px solid var(--line);
    }
    .left{
      display:flex;
      align-items:center;
      gap:14px;
      min-width:0;
    }
    .pill{
      padding:10px 14px;
      border-radius:14px;
      background:rgba(45,212,191,.14);
      border:1px solid rgba(45,212,191,.33);
      font-weight:1000;
      letter-spacing:.9px;
      text-transform:uppercase;
      white-space:nowrap;
      font-size:16px;
    }
    .titles{min-width:0}
    .title{
      font-size:26px;
      font-weight:1100;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:1100px;
    }
    .sub{
      margin-top:3px;
      color:var(--muted);
      font-weight:850;
      font-size:14px;
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .clock{
      font-weight:1000;
      font-size:28px;
      color:var(--muted);
      letter-spacing:.3px;
      min-width:160px;
      text-align:right;
    }

    /* FULLSCREEN TICKER AREA */
    .stage{
      flex:1;
      display:flex;
      flex-direction:column;
      justify-content:center;
      padding:16px;
      gap:14px;
    }

    .tickerWrap{
      position:relative;
      flex:1;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.10);
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      align-items:center;
      padding:14px 18px;
    }

    /* edge fades (pro look) */
    .tickerWrap:before, .tickerWrap:after{
      content:"";
      position:absolute;
      top:0;bottom:0;
      width:110px;
      z-index:3;
      pointer-events:none;
    }
    .tickerWrap:before{left:0;background:linear-gradient(90deg, rgba(9,12,18,1), rgba(9,12,18,0));}
    .tickerWrap:after{right:0;background:linear-gradient(270deg, rgba(9,12,18,1), rgba(9,12,18,0));}

    /* MARQUEE */
    .marquee{
      width:100%;
      overflow:hidden;
      position:relative;
      z-index:2;
    }
    .inner{
      display:inline-flex;
      align-items:center;
      gap:34px;
      white-space:nowrap;
      will-change:transform;
      animation:scroll linear infinite;
      animation-duration:60s; /* speed controlled in JS too */
      font-weight:1100;
      font-size:42px;         /* HUGE ticker */
      letter-spacing:.2px;
    }
    @keyframes scroll { from{transform:translateX(0)} to{transform:translateX(-50%)} }

    /* ONE ITEM */
    .item{
      display:inline-flex;
      align-items:center;
      gap:14px;
      padding:8px 2px;
    }

    /* STATUS TAG */
    .tag{
      font-size:14px;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
      font-weight:1100;
      letter-spacing:.7px;
      text-transform:uppercase;
      flex:0 0 auto;
    }
    .final{color:var(--lime);border-color:rgba(163,230,53,.35);background:rgba(163,230,53,.12)}
    .live{color:var(--amber);border-color:rgba(251,191,36,.35);background:rgba(251,191,36,.12)}
    .next{color:var(--teal);border-color:rgba(45,212,191,.35);background:rgba(45,212,191,.12)}

    /* SPORT DECAL (SVG) */
    .sportIcon{
      width:44px;
      height:44px;
      border-radius:16px;
      display:grid;
      place-items:center;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 6px 18px rgba(0,0,0,.30);
      flex:0 0 auto;
      color:rgba(243,246,255,.88);
    }
    .sportIcon svg{width:26px;height:26px}

    /* LOGOS (clean “badge” look) */
    .logo{
      width:52px;
      height:52px;
      border-radius:18px;
      display:grid;
      place-items:center;
      overflow:hidden;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 6px 18px rgba(0,0,0,.35);
      flex:0 0 auto;
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:contain;
      padding:7px;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,.35));
    }

    .teams{
      display:inline-flex;
      align-items:center;
      gap:14px;
      font-weight:1100;
    }

    .name{
      max-width:340px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }

    .vs{
      color:var(--muted);
      font-weight:1100;
      letter-spacing:1px;
      text-transform:uppercase;
      padding:6px 14px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.04);
      font-size:20px;
    }

    .score{
      font-weight:1200;
      letter-spacing:.5px;
    }

    .meta{
      color:var(--muted);
      font-weight:950;
      font-size:22px;
      letter-spacing:.2px;
    }

    .dot{
      color:var(--sep);
      font-weight:900;
      font-size:34px;
      margin:0 2px;
    }

    /* OPTIONAL 2nd line (smaller) — can be disabled */
    .tickerWrap.small{
      flex:0 0 auto;
      height:120px;
    }
    .inner.small{
      font-size:26px;
      animation-duration:80s;
      gap:26px;
    }

  </style>
</head>

<body>
  <div class="app">
    <div class="topbar">
      <div class="left">
        <div class="pill">Waconia HS</div>
        <div class="titles">
          <div class="title">Scores & Upcoming — Fullscreen Ticker</div>
          <div class="sub">
            <span id="updated">Updated: —</span>
            <span>•</span>
            <span id="counts">Loading…</span>
          </div>
        </div>
      </div>
      <div class="clock" id="clock">--:--</div>
    </div>

    <div class="stage">
      <!-- BIG PRIMARY TICKER -->
      <div class="tickerWrap">
        <div class="marquee">
          <div class="inner" id="innerBig">
            <span class="item"><span class="tag next">LOADING</span><span class="meta">Loading…</span></span>
          </div>
        </div>
      </div>

      <!-- SECONDARY TICKER (optional, looks amazing on big screens)
           If you want ONE ticker only, delete this whole block. -->
      <div class="tickerWrap small">
        <div class="marquee">
          <div class="inner small" id="innerSmall">
            <span class="item"><span class="tag next">INFO</span><span class="meta">Loading…</span></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ✅ Your working endpoints
    const FEED_URL  = "https://calm-limit-4982.shootscore3.workers.dev";
    const LOGO_PROXY = "https://calm-limit-4982.shootscore3.workers.dev/logo?u=";

    // Refresh + speeds
    const REFRESH_MS = 60_000;

    // Ticker speed: higher = slower (for readability)
    const BIG_SECONDS = 65;
    const SMALL_SECONDS = 95;

    const innerBig = document.getElementById("innerBig");
    const innerSmall = document.getElementById("innerSmall");
    innerBig.style.animationDuration = BIG_SECONDS + "s";
    innerSmall.style.animationDuration = SMALL_SECONDS + "s";

    const updatedEl = document.getElementById("updated");
    const countsEl = document.getElementById("counts");
    const clockEl = document.getElementById("clock");

    function pad(n){ return String(n).padStart(2,"0"); }
    function tickClock(){
      const d = new Date();
      const h12 = ((d.getHours()+11)%12)+1;
      const ampm = d.getHours()>=12 ? "PM":"AM";
      clockEl.textContent = `${h12}:${pad(d.getMinutes())} ${ampm}`;
    }

    function normStatus(s){
      s = (s || "next").toLowerCase().trim();
      if (s === "upcoming") return "next";
      if (s === "final" || s === "live" || s === "next") return s;
      return "next";
    }

    function tagHtml(status){
      if(status === "final") return '<span class="tag final">FINAL</span>';
      if(status === "live")  return '<span class="tag live">LIVE</span>';
      return '<span class="tag next">NEXT</span>';
    }

    // ---- sport SVG decals (chunky “decal” style) ----
    function sportSvg(type){
      const common = `fill="none" stroke="currentColor" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"`;
      const wrap = (inner)=>`<svg viewBox="0 0 24 24" ${common}>${inner}</svg>`;
      const t = (type||"").toLowerCase();

      if(t.includes("basketball")) return wrap(`<circle cx="12" cy="12" r="9"/><path d="M3.5 12h17"/><path d="M12 3.5c3.6 3.9 3.6 13.1 0 17"/><path d="M12 3.5c-3.6 3.9-3.6 13.1 0 17"/>`);
      if(t.includes("football")) return wrap(`<path d="M7.2 10c4.3-5.3 10.9-4.6 10.1 2.2-.8 6.9-6.7 7.6-10.1 2.2-1.2-1.9-.5-3.1 0-4.4Z"/><path d="M10 12h4"/><path d="M11 10.8v2.4"/><path d="M13 10.8v2.4"/>`);
      if(t.includes("hockey")) return wrap(`<path d="M7 4v9a4 4 0 0 0 8 0V4"/><path d="M6 20h10"/><path d="M10 20v-4"/><path d="M14 20v-4"/><path d="M4.5 17h15"/>`);
      if(t.includes("baseball") || t.includes("softball")) return wrap(`<circle cx="12" cy="12" r="9"/><path d="M8 7c2.3 2.5 2.3 7.5 0 10"/><path d="M16 7c-2.3 2.5-2.3 7.5 0 10"/>`);
      if(t.includes("soccer")) return wrap(`<circle cx="12" cy="12" r="9"/><path d="M12 7l3 2-1 3h-4l-1-3 3-2Z"/><path d="M9 12l-3 2"/><path d="M15 12l3 2"/><path d="M11 15l-1.5 3"/><path d="M13 15l1.5 3"/>`);
      if(t.includes("volleyball")) return wrap(`<circle cx="12" cy="12" r="9"/><path d="M12 3a9 9 0 0 1 0 18"/><path d="M12 3c-3.2 2.2-5.2 6.2-5.2 9s2 6.8 5.2 9"/><path d="M7.2 7.2a9 9 0 0 0 10 2"/>`);
      if(t.includes("wrestling")) return wrap(`<path d="M7 7a3 3 0 1 0 4 3"/><path d="M13 10a3 3 0 1 0 4 3"/><path d="M9 10l6 4"/><path d="M8 18h8"/>`);
      return wrap(`<path d="M4 18V6"/><path d="M20 18V6"/><path d="M4 12h16"/>`);
    }

    function sportIconHtml(sportType){
      return `<span class="sportIcon">${sportSvg(sportType)}</span>`;
    }

    function logoHtml(teamName, logoUrl){
      if(logoUrl){
        const proxied = LOGO_PROXY + encodeURIComponent(logoUrl);
        return `<span class="logo"><img src="${proxied}" alt="${teamName} logo" loading="lazy"></span>`;
      }
      // fallback: show initials in a badge-like box
      const initials = (teamName||"HS").split(/\s+/).map(w=>w[0]).join("").slice(0,3).toUpperCase();
      return `<span class="logo" style="display:grid;place-items:center;color:rgba(243,246,255,.85);font-size:16px;font-weight:1100">${initials}</span>`;
    }

    function fmtScore(a,b){
      if(a == null || b == null) return "—";
      return `${a}-${b}`;
    }

    function itemHtml(it){
      const status = normStatus(it.status);

      // Prefer structured fields (your Worker now provides these)
      const sport = it.sport || "";
      const sportType = it.sportType || sport;
      const away = it.away || "—";
      const home = it.home || "—";
      const awayScore = (it.awayScore ?? null);
      const homeScore = (it.homeScore ?? null);
      const vsWord = it.vsWord || "vs";
      const detail = it.time ? it.time : (it.location ? it.location : "");

      const scoreText = (status === "final" || status === "live") ? fmtScore(awayScore, homeScore) : "";

      return `
        <span class="item">
          ${tagHtml(status)}
          ${sportIconHtml(sportType)}
          ${logoHtml(away, it.awayLogo)}
          <span class="teams">
            <span class="name">${away}</span>
            <span class="vs">${vsWord}</span>
            <span class="name">${home}</span>
          </span>
          ${logoHtml(home, it.homeLogo)}
          ${scoreText ? `<span class="score">${scoreText}</span>` : ``}
          ${detail ? `<span class="meta">• ${detail}</span>` : ``}
        </span>
      `;
    }

    function dedupeByKey(items){
      // Basic dedupe so repeats don’t spam the ticker
      const seen = new Set();
      const out = [];
      for(const it of items){
        const key = `${it.status}|${it.sport}|${it.away}|${it.home}|${it.date}|${it.time||""}`;
        if(seen.has(key)) continue;
        seen.add(key);
        out.push(it);
      }
      return out;
    }

    function buildTicker(innerEl, items){
      if(!items.length){
        innerEl.innerHTML = `<span class="item">${tagHtml("next")} <span class="meta">No games found</span></span>`;
        return;
      }
      const chunks = items.map(itemHtml);
      const html = chunks.join(`<span class="dot">•</span>`);
      // duplicate for seamless loop
      innerEl.innerHTML = html + `<span class="dot">•</span>` + html;
    }

    function sortItems(items){
      // LIVE first, then FINAL (most recent), then NEXT (soonest)
      const rank = (s)=>{
        s = normStatus(s);
        if(s==="live") return 0;
        if(s==="final") return 1;
        return 2;
      };
      return items.slice().sort((a,b)=>{
        const ra = rank(a.status), rb = rank(b.status);
        if(ra !== rb) return ra - rb;

        // finals newest first; next soonest first
        const da = (a.date || ""), db = (b.date || "");
        if(normStatus(a.status)==="final" && normStatus(b.status)==="final"){
          return db.localeCompare(da);
        }
        return da.localeCompare(db);
      });
    }

    async function load(){
      try{
        const res = await fetch(FEED_URL + "?v=" + Date.now(), { cache:"no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        const raw = Array.isArray(data.items) ? data.items : [];

        const items = sortItems(dedupeByKey(raw));

        // counts
        const live = items.filter(x=>normStatus(x.status)==="live").length;
        const fin  = items.filter(x=>normStatus(x.status)==="final").length;
        const nxt  = items.filter(x=>normStatus(x.status)==="next").length;
        countsEl.textContent = `LIVE ${live} • FINAL ${fin} • NEXT ${nxt}`;

        // updated
        if(data.updated){
          const d = new Date(data.updated);
          const h12 = ((d.getHours()+11)%12)+1;
          const ampm = d.getHours()>=12 ? "PM":"AM";
          updatedEl.textContent = `Updated: ${h12}:${pad(d.getMinutes())} ${ampm}`;
        } else updatedEl.textContent = "Updated: —";

        // Build big ticker with everything
        buildTicker(innerBig, items.slice(0, 40));

        // Small ticker: show only NEXT games (or only FINALS) for variety
        const nextOnly = items.filter(x=>normStatus(x.status)==="next").slice(0, 40);
        buildTicker(innerSmall, nextOnly.length ? nextOnly : items.slice(0,40));

      } catch(e){
        countsEl.textContent = "Feed error";
        innerBig.innerHTML = `<span class="item">${tagHtml("next")} <span class="meta">Unable to load ticker data</span></span>`;
        innerSmall.innerHTML = innerBig.innerHTML;
        console.error(e);
      }
    }

    tickClock();
    setInterval(tickClock, 1000);
    load();
    setInterval(load, REFRESH_MS);
  </script>
</body>
</html>

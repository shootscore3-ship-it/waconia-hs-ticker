<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Waconia HS Ticker</title>
  <style>
    :root{
      --bg1:#0b0f14;
      --bg2:#111826;
      --text:#f3f6ff;
      --muted:rgba(243,246,255,.70);
      --sep:rgba(243,246,255,.22);
      --teal:#2dd4bf;
      --lime:#a3e635;
      --amber:#fbbf24;
    }
    html,body{margin:0;height:100%;background:transparent;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .bar{
      position:fixed;left:0;right:0;bottom:0;height:90px;
      background:linear-gradient(90deg,var(--bg1),var(--bg2));
      border-top:2px solid rgba(255,255,255,.10);
      display:flex;align-items:center;gap:14px;padding:12px 16px;box-sizing:border-box;color:var(--text);
    }
    .label{
      padding:10px 14px;border-radius:14px;
      background:rgba(45,212,191,.14);
      border:1px solid rgba(45,212,191,.33);
      font-weight:900;letter-spacing:.7px;text-transform:uppercase;white-space:nowrap;
      font-size:16px;
    }
    .marquee{
      position:relative;
      flex:1;
      overflow:hidden;
      height:100%;
      display:flex;
      align-items:center;
    }

    /* Fade edges (pro look) */
    .marquee:before, .marquee:after{
      content:"";
      position:absolute;top:0;bottom:0;width:40px;z-index:2;pointer-events:none;
    }
    .marquee:before{left:0;background:linear-gradient(90deg,var(--bg2),rgba(17,24,38,0));}
    .marquee:after{right:0;background:linear-gradient(270deg,var(--bg2),rgba(17,24,38,0));}

    .inner{
      display:inline-flex;
      align-items:center;
      gap:26px;
      white-space:nowrap;
      will-change:transform;
      animation:scroll linear infinite;
      animation-duration:60s; /* slower = easier to read */
      font-size:24px;
      font-weight:800;
    }
    @keyframes scroll { from{transform:translateX(0)} to{transform:translateX(-50%)} }

    .item{display:inline-flex;align-items:center;gap:10px;}
    .dot{color:var(--sep);font-weight:700;}

    .tag{
      font-size:13px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.06);
      font-weight:900;
      letter-spacing:.5px;
    }
    .final{color:var(--lime);border-color:rgba(163,230,53,.35);background:rgba(163,230,53,.10)}
    .live{color:var(--amber);border-color:rgba(251,191,36,.35);background:rgba(251,191,36,.10)}
    .next{color:var(--teal);border-color:rgba(45,212,191,.35);background:rgba(45,212,191,.10)}

    .sport{color:var(--muted);font-weight:900;}
    .text{color:var(--text);}

  </style>
</head>

<body>
  <div class="bar">
    <div class="label">WACONIA HS</div>
    <div class="marquee">
      <div class="inner" id="inner"><span class="item"><span class="tag next">LOADING</span><span class="text">Loading…</span></span></div>
    </div>
  </div>

  <script>
    const FEED_URL = "https://calm-limit-4982.shootscore3.workers.dev";

    const REFRESH_MS = 60_000;

    // speed: bigger = slower
    const SCROLL_SECONDS = 60;

    const inner = document.getElementById("inner");
    inner.style.animationDuration = SCROLL_SECONDS + "s";

    function normStatus(s){
      s = (s || "next").toLowerCase().trim();
      if (s === "upcoming") return "next";
      if (s === "final" || s === "live" || s === "next") return s;
      return "next";
    }

    function tagHtml(status){
      if(status === "final") return '<span class="tag final">FINAL</span>';
      if(status === "live")  return '<span class="tag live">LIVE</span>';
      return '<span class="tag next">NEXT</span>';
    }

    // Attempt to pull sport label from the text (before first "•")
    function splitSportAndRest(line){
      // Your demo lines look like: "Girls Basketball • Waconia 58 vs Chanhassen 51"
      const parts = (line || "").split("•").map(x => x.trim()).filter(Boolean);
      if(parts.length >= 2){
        return { sport: parts[0], rest: parts.slice(1).join(" • ") };
      }
      return { sport: "", rest: line || "" };
    }

    function render(items){
      if(!items || items.length === 0){
        inner.innerHTML = `<span class="item">${tagHtml("next")} <span class="text">No games found</span></span>`;
        return;
      }

      const chunks = items.map(it => {
        const st = normStatus(it.status);
        const txt = it.text || "";
        const { sport, rest } = splitSportAndRest(txt);
        const sportHtml = sport ? `<span class="sport">${sport}</span><span class="dot">•</span>` : "";
        return `<span class="item">${tagHtml(st)} ${sportHtml}<span class="text">${rest}</span></span>`;
      });

      const html = chunks.join(`<span class="dot">•</span>`);
      inner.innerHTML = html + `<span class="dot">•</span>` + html; // duplicate for looping
    }

    async function load(){
      try{
        const res = await fetch(FEED_URL + "?v=" + Date.now(), { cache: "no-store" });
        if(!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        render(data.items || []);
      }catch(e){
        inner.innerHTML = `<span class="item">${tagHtml("next")} <span class="text">Unable to load ticker data</span></span>`;
        console.error("Ticker load error:", e);
      }
    }

    load();
    setInterval(load, REFRESH_MS);
  </script>
</body>
</html>
